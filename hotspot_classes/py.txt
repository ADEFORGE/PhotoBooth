partie serveur flask

# Active la synchronisation NTP automatique
sudo timedatectl set-ntp true

# VÃ©rifie la date
timedatectl

sudo date -s "2025-07-04 12:00:00"


sudo apt update
sudo apt install python3 python3-pip python3-flask python3-pil

python3 - <<'EOF'
import flask, PIL
print("Flask", flask.__version__)
print("Pillow", PIL.__version__)
EOF


mkdir -p ~/flask_rpi
cd ~/flask_rpi

nano app.py


chmod +x ~/flask_rpi/app.py

sudo nano /etc/systemd/system/flask_rpi.service



chmod +x app.py
sudo systemctl daemon-reload
sudo systemctl enable flask_rpi.service
sudo systemctl start flask_rpi.service
sudo systemctl restart flask_rpi.service
sudo systemctl status flask_rpi.service



sudo apt install python3-flask python3-pil hostapd dnsmasq nodogsplash
pip3 install qrcode


# a) Remettre wlan0 en place avec son IP statique
sudo ip link set wlan0 down
sudo ip addr flush dev wlan0
sudo ip addr add 192.168.5.1/24 dev wlan0
sudo ip link set wlan0 up

# b) RedÃ©marrer hostapd (le point dâ€™accÃ¨s)
sudo systemctl restart hostapd

# c) RedÃ©marrer dnsmasq (DHCP/DNS captive)
sudo systemctl restart dnsmasq

# d) RedÃ©marrer Nodogsplash (portail captif)
sudo systemctl restart nodogsplash

# e) VÃ©rifier que tout est UP
sudo systemctl status hostapd --no-pager
sudo systemctl status dnsmasq --no-pager
sudo systemctl status nodogsplash --no-pager






Pense Ã  crÃ©er /etc/nodogsplash/htdocs/splash_template.html ainsiâ€¯:

html
Copy
Edit
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hotspot Image</title>
</head>
<body>
  <!-- IMAGE_PLACEHOLDER -->
  <!-- QR_PLACEHOLDER -->
</body>
</html>
Ensuite, relance ton serviceâ€¯:

bash
Copy
Edit
sudo systemctl restart flask_rpi.service


sudo systemctl status flask_rpi.service
Ping la Pi en Ethernet :

powershell
Copy
Edit
ping 192.168.10.2

Jâ€™ai corrigÃ© la balise mal fermÃ©e (</nscript> â†’ </script>) dans le script de tÃ©lÃ©chargement automatique. Le service Flask devrait maintenant dÃ©marrer sans erreur.

ðŸš€ Relance le service :

bash
Copy
Edit
sudo systemctl daemon-reload
sudo systemctl restart flask_rpi.service
Puis vÃ©rifie :

bash
Copy
Edit
sudo systemctl status flask_rpi.service
Tout devrait Ãªtre active (running).